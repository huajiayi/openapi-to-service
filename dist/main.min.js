!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t(require("umi-request"),require("fs"),require("ejs"),require("path")):"function"==typeof define&&define.amd?define(["umi-request","fs","ejs","path"],t):(e="undefined"!=typeof globalThis?globalThis:e||self).View=t(e.request,e.fs,e.ejs,e.path)}(this,(function(e,t,r,i){"use strict";function n(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}var s=n(e),a=n(t),o=n(r);const p=e=>e.split("<").map((e=>e.replace(/>/g,"").replace(/\[\]/g,""))),c=e=>e.replace(/<T>/g,""),u=(e,t)=>{if(!e)return"any";const{type:r}=e;if(!r&&e.originalRef)return e.originalRef;return["int64","integer","long","float","double","number","int","float","double","int32","int64"].includes(r)?"number":["Date","date","dateTime","date-time","datetime"].includes(r)||["string","email","password","url","byte","binary"].includes(r)?"string":"boolean"===r?"boolean":"object"===r?t?"T":e.originalRef??e.additionalProperties?.type??"any":"array"===r?t?"T[]":`${e.items.originalRef??u(e.items)}[]`:"any"},l=e=>e.includes("{")?`\`${e.replace(/{/g,"${pathVars.")}\``:`'${e}'`,d=(e,t)=>{const r=(e,t)=>{const r=e[200];if(r.schema?.type)return u(r.schema);if(r.schema?.originalRef){let e=r.schema?.originalRef?.replace(/«/g,"<").replace(/»/g,">");return 1===p(e).length&&t.includes(e)&&(e+="<any>"),e}return"any"},i=[];return Object.keys(e.paths).forEach((n=>{const s=e.paths[n];Object.keys(s).forEach((a=>{const o=s[a],p=((e,t)=>{if(!e||0===e.length)return[];if("body"===e[0]?.in){const r=e?.[0]?.schema.originalRef,i=t[r]?.properties;return Object.keys(i).map((e=>{const t=i[e];return{in:"body",name:e,type:u(t,!1),description:t.description,required:!1}}))}return e.map((e=>({in:e.in,name:e.name,type:u(e,!1),description:e.description,required:e.required})))})(o.parameters,e.definitions);i.push({tag:o.tags?.[0],name:o.operationId,description:o.summary,request:{url:n,urlText:l(n),method:a.toUpperCase(),params:p,filter:{path:p.filter((e=>"path"===e.in)),query:p.filter((e=>"query"===e.in)),body:p.filter((e=>"body"===e.in)),formdata:p.filter((e=>"formdata"===e.in))}},response:{type:r(o.responses,t.filter((e=>e.isGenerics)).map((e=>c(e.name))))}})}))})),i},f=(e,t)=>new Promise(((r,i)=>{o.default.renderFile(e,t,{},((e,t)=>{e&&i(e.message),r(t)}))})),m=async(e,t)=>{const r=(e=>{const t=new Set;Object.keys(e.definitions).forEach((e=>{const r=e.split("«");r.pop(),r.forEach((e=>t.add(e)))}));const r=[];return Object.keys(e.definitions).forEach((i=>{if(i.split("«").length>1)return;const n=e.definitions[i];if(!n.properties)return;const s=t.has(i)&&!r.some((e=>e.name===i));var a,o;r.push({isGenerics:s,name:s?`${i}<T>`:i,description:n.description,params:(a=n.properties,o=s,Object.keys(a).map((e=>{const t=a[e];return{isGenerics:o,name:e,type:u(t,o),description:t.description,required:!1}})))})})),r})(e),n=i.resolve(__dirname,"../","src","template","type.ejs"),s=await f(n,{types:r}),o=i.resolve(t,"typings.ts");a.default.writeFileSync(o,s);const l=d(e,r),m=new Map;e.tags.forEach((e=>{m.set(e.name,[])})),l.forEach((e=>m.get(e.tag)?.push(e))),m.forEach((async(e,n)=>{const s=i.resolve(__dirname,"../","src","template","umi-request.ejs"),o=new Set;e.forEach((e=>{e.request.params.forEach((e=>{const t=e.type.replace(/\[\]/g,"");r.some((e=>c(e.name)===t))&&o.add(t)})),p(e.response.type).forEach((e=>{r.some((t=>c(t.name)===e))&&o.add(e)}))}));const u=await f(s,{deps:o,apis:e}),l=i.resolve(t,`${n}.ts`);a.default.writeFileSync(l,u)}))};return async e=>{const{data:t,url:r,outputDir:i}=e;if(!t&&!r)throw new Error("please input either data or url!");if(!i)throw new Error("please input outputDir!");let n={};r&&(n=await s.default.get(r)),t&&(n=JSON.parse(t)),m(n,i)}}));